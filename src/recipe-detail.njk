---
pagination:
  data: recipes
  size: 1
  alias: recipe
permalink: "/recipes/{{ recipe.slugCategory }}/{{ recipe.slugFilename }}/"
layout: base.njk
eleventyComputed:
  # Page <title> (browser tab)
  title: "{{ (recipe.title and recipe.title | trim) or (recipe.filename | replace('-', ' ') | title) }}"
---

{# Compute a display title once, reuse everywhere #}
{% set displayTitle = (recipe.title and recipe.title | trim) or (recipe.filename | replace('-', ' ') | title) %}

<article class="recipe-page">
  <header class="recipe-hero">
    <h1 class="recipe-title">{{ displayTitle }}</h1>
    <button class="print-btn" onclick="window.print()">ðŸ–¨ Print</button>
  </header>
  
  {# ---- ORDER: Ingredients, Instructions, Remarks, Yield, Source, Image, Tags ---- #}

  {% if recipe.ingredients and recipe.ingredients.length %}
    <h2>Ingredients</h2>
    <ul class="ingredients">
      {% for item in recipe.ingredients %}
        <li>{{ item }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  {% if recipe.instructions and recipe.instructions.length %}
    <h2>Instructions</h2>
    <ol class="instructions">
      {% for step in recipe.instructions %}
        <li>{{ step }}</li>
      {% endfor %}
    </ol>
  {% endif %}

  {% if recipe.remarks %}
    <h2>Remarks</h2>
    <p class="notes">{{ recipe.remarks }}</p>
  {% endif %}

  {% if recipe.yield %}
    <h2>Yield</h2>
    <p class="yield">{{ recipe.yield }}</p>
  {% endif %}

  {% if recipe.source %}
    <h2>Source</h2>
    <p class="source">{{ recipe.source }}</p>
  {% endif %}

  {# Image section (robust, Nunjucks-safe) #}
  {% set rawImg = recipe.image or recipe.imageAbs or recipe.img or recipe.photo %}
  {% if rawImg %}
    {# Absolute URL? keep as-is #}
    {% if rawImg.indexOf('http://') == 0 or rawImg.indexOf('https://') == 0 or rawImg.indexOf('//') == 0 %}
      {% set imgSrc = rawImg %}
    {# Starts with "/"? treat as site-absolute and run through |url so pathPrefix is added #}
    {% elseif rawImg[0] == '/' %}
      {% set imgSrc = rawImg | url %}
    {# Otherwise assume it's a filename in /src/images -> /images/<file> (then |url for pathPrefix) #}
    {% else %}
      {% set imgSrc = ('/images/' + rawImg) | url %}
    {% endif %}

    <h2>Image</h2>
    <figure class="recipe-figure">
      <img src="{{ imgSrc }}" alt="{{ recipe.imageAlt or displayTitle }}" loading="lazy" decoding="async">
      {% if recipe.imageCredit %}
        <figcaption class="image-credit">{{ recipe.imageCredit }}</figcaption>
      {% endif %}
    </figure>
  {% endif %}


  {% if recipe.tags and recipe.tags.length %}
    <h2>Tags</h2>
    <ul class="tags">
      {% for t in recipe.tags %}
        <li><a href="{{ '/tags/' | url }}#{{ t | slug }}">{{ t }}</a></li>
      {% endfor %}
    </ul>
  {% endif %}
</article>

